process help=*
PARM INP      TYPE=STRING  COUNT=1
PARM OUT      TYPE=STRING  COUNT=1
PARM DIR      TYPE=STRING  COUNT=0:1			        DEFAULT=--
PARM DIRCAL   TYPE=STRING  COUNT=0:1        			DEFAULT=--    
PARM DIRDC    TYPE=STRING  COUNT=0:1        			DEFAULT=--
PARM DIRBLM   TYPE=STRING  COUNT=0:1        			DEFAULT=--
PARM DIROFF   TYPE=STRING  COUNT=0:1        			DEFAULT=--
PARM CAL      TYPE=STRING  COUNT=0:1               		DEFAULT=--
PARM DC       TYPE=STRING  COUNT=0:1               		DEFAULT=--
PARM BLEM     TYPE=STRING  COUNT=0:1               		DEFAULT=--
PARM OFFSETS  TYPE=STRING  COUNT=0:1               		DEFAULT=--
PARM IOF      TYPE=REAL	   COUNT=0:1	   		  	DEFAULT=1.0
PARM CONV     TYPE=REAL    COUNT=0:1				DEFAULT=--
PARM SOLRANGE TYPE=REAL    COUNT=0:1				DEFAULT=-- 
PARM BITWT    TYPE=KEYWORD COUNT=1   VALID=(UBWC,NOUBWC)  	DEFAULT=NOUBWC
PARM UPDATE   TYPE=KEYWORD COUNT=0:1 VALID=UPDATE	  	DEFAULT=--
PARM PENTROPY TYPE=KEYWORD COUNT=1   VALID=(PRINT,NOPRINT)	DEFAULT=NOPRINT
PARM NOCHECK  TYPE=KEYWORD COUNT=0:1 VALID=NOCHECK		DEFAULT=--
PARM FILTER   TYPE=INTEGER COUNT=0:1 VALID=(0:7)		DEFAULT=--
PARM GAIN     TYPE=INTEGER COUNT=0:1 VALID=(1:4)		DEFAULT=--
PARM EXPOSURE TYPE=REAL	   COUNT=0:1				DEFAULT=--
PARM CFILTER  TYPE=INTEGER COUNT=0:1 VALID=(0:7)		DEFAULT=--
PARM CGAIN    TYPE=INTEGER COUNT=0:1 VALID=(1:4)		DEFAULT=--
PARM DCGAIN   TYPE=INTEGER COUNT=0:1 VALID=(1:4)		DEFAULT=--
PARM CATSRV   TYPE=STRING  COUNT=0:1                            DEFAULT=-- 
PARM CATDB    TYPE=STRING  COUNT=0:1                            DEFAULT=--
PARM CATUSR   TYPE=STRING  COUNT=0:1                            DEFAULT=--
PARM CATPW    TYPE=STRING  COUNT=0:1                            DEFAULT=--
PARM TARGET     TYPE=(STRING,12) COUNT=0:1                      DEFAULT=--
PARM SPICEMODE  TYPE=KEYWORD     COUNT=0:1 VALID=(LOCAL,REMOTE) DEFAULT=--
PARM CKNAME     TYPE=(STRING,4)  COUNT=1                        DEFAULT=DAVI
PARM CKID       TYPE=(STRING,4)  COUNT=1                        DEFAULT=NONE
PARM DEBUG    TYPE=KEYWORD COUNT=0:1 VALID=DEBUG		DEFAULT=--
END-PROC

.TITLE
Vicar2 Program GALSOS
.HELP
PURPOSE:

GALSOS will radiometrically correct Galileo SSI images, converting
each raw DN value (as acquired by the camera) to units of reflectance or
radiance.  GALSOS will also remove camera blemishes, compute the image
entropy, and encode the locations of invalid pixels as bad-data records.

EXECUTION:

  GALSOS  INP=PIC  OUT=OPIC  user-parameters...
where 
  PIC  is the image to be radiometrically corrected (byte image).
  OPIC is the radiometrically corrected output image (16-bit integer).

The input image (PIC) may be an SSI image containing a binary label (e.g. UDR
or REDR), or without a binary label (e.g. ground calibration image or a flight
image with binary labels removed).  Both Phase 1 and Phase2 UDR formats are
supported.

If the input is a UDR or REDR, the output image (OPIC) is an SSI EDR.
If the input image contains no binary labels, the output will not be in EDR
format and will not include any binary labels.  Note that in this case,
GLLFILLIN will not function.

.page
REFERENCES:

1) JPL D-4264, "MIPL Software Structural Design for the Instrument Calibration
   of GLL SSI Science Processing", by Gary Yagi, June, 1987.
2) GMY:384-94-011, "Galileo SSI Picture Label, Revision 5", April 7, 1994.
3) 625-210, "Galileo SSI Calibration Report Part 1", K. Klaasen, H. Breneman,
   November 1, 1988.
4) GLL SIS 232-04, "SSI Unprocessed Data Record for OPNAV"
5) GLL SIS 232-07, "SSI Experiment Data Record"
6) JPL IOM 384-91-3, "Tracking GLL SSI Bad-Data Values, Binary Label Design,
   Revision 2", May 14, 1991.
7) GLL SIS 232-16, "SSI Raw Experiment Data Record CDROM", April 20, 1992.
8) GLL SIS 232-12, "SSI Image Catalog (Jupiter Encounter)", 1995?.

.page
OPERATION:

GALSOS will radiometrically correct the input image, using  a linear
light-transfer model to convert each raw DN value to units of reflectance or
radiance.  GALSOS will also remove camera blemishes, compute the image
entropy, and encode the locations of invalid pixels as bad-data records.

The processing parameters and calibration files used are recorded in the VICAR
label.  This label information is sufficient to reverse the radiometric
correction process (see program GALSOSI).

If the input image is a UDR or REDR, the output image will be in EDR format.
If the keyword 'UPDATE is specified, the disk location of the EDR is recorded
in the Corrected Table of the SSI Catalog, together with a record of the
calibration files used, radiometric scale factor, and miscellaneous statistical
data.

Detailed information is included below under the following topic headings:

   PROCESSING OF UDRs and REDRs
   PROCESSING OF GROUND CALIBRATION IMAGES
   REQUIRED INPUT CALIBRATION DATA
   DETERMINATION OF CAMERA PARAMETERS
   CORRECTING ERRONEOUS LABEL INFORMATION
   RATIOMETRIC CORRECTION
   ENTROPY CALCULATION
   CREATING THE OUTPUT IMAGE LABEL
   LOGGING IN TO SYBASE
   UPDATING THE SSI CATALOG
   TIMING
   EXAMPLES
   PROGRAM HISTORY

.page
PROCESSING OF UDRs and REDRs:

A UDR is a raw SSI image containing ancillary information in the binary header
and binary prefix portion of the VICAR label (ref. 4).  An REDR is a UDR upon
which one or more of the following programs have been executed: CATLABEL,
BADLABELS, GLLBLEMCOR, GLLFILLIN, ADESPIKE (ref 7).  The order in which these
programs are executed is optional, except that BADLABELS must precede any
execution of GLLBLEMCOR, GLLFILLIN, or ADESPIKE.  This is because BADLABELS
adds the bad-data label records necessary for the proper functioning of the
other programs (ref 6).

Note that if GLLFILLIN has been run, its effect will be cancelled since GALSOS
fills all truncated or missing lines with -32768 DN (see below).  This side-
effect can be countered by re-running GLLFILLIN after executing GALSOS.

GALSOS will identify bad-data values and record their locations as bad-data
records in the binary header portion of the VICAR label (ref. 6).  The following
types of bad-data values are handled:

  (1) Data dropouts	    Line gaps or lines truncated by the data compressor.
  (2) Low-full-well pixels  Samples whose values exceed full-well (ref. 1).
  (3) Camera blemishes      Samples which cannot be calibrated.
  (4) Saturated pixels      Samples whose raw values are 0 or 255 DN.
  (5) Reed/Solomon errors   Reed/Solomon overflow records.

Data drop-outs are detected by examining the segements field in the binary
prefix of each image line.  No radiometric correction is performed on data
gaps and -32768 DN is stored in these output samples.

Low-full-well pixels and camera blemishes are identified from data retrieved
from the Blemish File.  These pixels are replaced by interpolating over
neighboring radiometrically corrected samples.

Saturated pixels are identified by scanning the pixels for 0 and 255 DN.
These pixels are radiometrically corrected unless they fall in another of the
above categories.

Reed/Solomon overflow errors can be detected in Phase 1 UDRs or REDRs by
examining the binary prefix portion of each image line.  Since it is not
possible to determine what portion of the line is effected by the overflow,
the entire line is declared to be invalid.

Data drop-outs, low-full-well pixels, saturated pixels, and Reed-Solomon
overflow records are recorded as invalid data in the bad-data value portion
of the binary header.  Note, however, that camera blemishes are not recorded
in the binary header since their positions are defined in the Blemish File.

If BADLABELS has already been executed on an input REDR, GALSOS copies the
bad-data value header records for data drop-outs, and saturated pixels from
the REDR to the output EDR (instead of creating these records as above).

Similarly, if GLLBLEMCOR has already been executed, the bad-data value header
records for low-full-well pixels are copied from the REDR.

.page
PROCESSING OF GROUND CALIBRATION DATA:

Ground calibration files are identified by the obsolete IBM label wherein
the label information is stored as character strings under label items
LAB01, LAB02, etc.  These files contain no binary headers.  Consequently,
bad-data label records are not created and the output image will contain
no binary labels (i.e. not an EDR).  Summation-mode images are input as
400x400 byte images and output as 400x400 halfword images.  Full-frame images
are input as 800x800 byte images and output as 800x800 halfword images.

Because of the absence of binary labels in the input image, GALSOS cannot
identify data drop-outs, or truncated lines.  Consequently, all pixels not
identified as blemishes or low full-well pixels are treated as valid (Reed-
Solomon overflow cannot occur during ground calibration).

GALSOS will also accept as input flight images from which the binary labels
have been removed.  These images are treated similar to ground-calibration
images.

.page
REQUIRED INPUT CALIBRATION DATA:

In addition to the input image (PIC), GALSOS requires the following calibration
data:

  (1) a radiometric file generated from calibration data acquired at the same
      filter position as the input image.
  (2) a dark-current file acquired at the same camera gain-state, frame-rate,
      PNI, and blemish-protect mode (BPM) settings.  Note also that extended-
      exposure mode frames require an extended-exposure mode dark-current file.
  (3) a blemish file generated from calibration data acquired at the same filter
      position, gain-state, and camera mode (full-frame or summation).
  (4) a shutter-offset file.

The radiometric and dark-current files are generated by the radiometric
calibration program GALGEN.  Individual dark-current frames or PICSUMs of
multiple dark-current frames may also be used.  The blemish file is generated
by BLEMGEN and the shutter-offset file is generated by CCDRECIP (Ref. 1).

GALSOS will automatically locate the correct calibration data by searching the
Radiometric Catalog (Ref. 1).  The Catalog contains the directory and filenames
of all radiometric, dark-current, blemish, and shutter-offset files required to
process SSI images.  If the Radiometric Catalog exists, the user need only
specify the input and output image locations:

  GALSOS  INP=S12345.1  OUT=S12345.EDR

If the Radiometric Catalog does not exist, GALSOS will automatically construct
the filenames for the radiometric, dark-current, blemish, and shutter-offset
files using camera parameter information extracted from the VICAR label
(see DETERMINATION OF CAMERA PARAMETERS below).  This assumes that all
calibration filenames adhere to the naming convention documented in subroutine
GLLCALNAME.  The directory locations, however, must be specified via one or
more of the following parameters:

  DIR		Default disk directory for all calibration files.
  DIRCAL	Directory containing the radiometric file.
  DIRDC		Directory containing the dark-current file.
  DIRBLM	Directory containing the blemish file.
  DIROFF	Directory containing the shutter-offset file.

For example,

  GALSOS  INP=S12345.1  OUT=S12345.EDR  DIR=GLL:[LAW]  DIRDC=GLL1:[GMY]

specifies that all calibration files except the dark-current are located in
disk directory GLL:[LAW].  The following example shows how directory
specifications are made on Unix:

  GALSOS  INP=S1.1  OUT=S1.EDR  DIR=/gll/law/cal/  DIRDC=/gll1/gmy/

The calibration filenames extracted from the Catalog or constructed by GALSOS
may be overridden via the following parameters:

  CAL		Radiometric file
  DC		Dark-current file
  BLEM		Blemish file
  OFFSETS	Shutter-offset file

For example,

  GALSOS  INP=S12345.1  OUT=S12345.EDR  DIR=GLL:[LAW]  CAL=R2D2.RC

specifies that radiometric file R2D2.RC should be used. All other calibration
files are located via the Radiometric Catalog.  ALL calibration files are
expected to be in directory GLL:[LAW].

.page
DETERMINATION OF CAMERA PARAMETERS

The radiometric correction process is dependent on the following camera
settings: filter position, exposure time, gain state, frame rate,
extended-exposure mode, inverted/noinverted mode (PNI), and blemish
protection mode (BPM).  These parameters effect both the calibration files
selected and the equations used to perform the correction.

GALSOS extracts the filter position, exposure time, and frame-rate
from the label of the input.

GALSOS extracts the filter position from the label of the radiometric file.

GALSOS extracts the frame-rate, extended exposure mode, PNI, and BPM settings
from the label of the dark-current file.

GALSOS compares the camera parameters for the input images with those for each
of the calibration files.  If the input calibration files are incompatible with
the input image, processing is aborted.

If the keyword 'NOCHECK is specified, a warning message is printed whenever
a parameter mismatch is detected but processing continues.

.page
CORRECTING ERRONEOUS LABEL INFORMATION

As mentioned above, GALSOS extracts various camera parameters from the VICAR
labels of the input image and the radiometric, dark-current, and blemish
files.  In addition, label item SOLRANGE is required to convert the output
pixels into units of reflectance (see below).  When the VICAR label contains
erroreous information, it must be corrected prior to input to GALSOS.  If the
correct information is available in the Overview Table of the SSI Catalog,
program CATLABEL may be used to correct the label.  Otherwise, program LABEL-
REPLACE must be used to correct the label.

Since neither CATLABEL nor LABEL-REPLACE can be used to correct ground
calibration labels (because of the obsolete IBM label format), the following
parameters may be used for these files only:

  (1) Parameters FILTER, EXPOSURE, and GAIN override the input image label.
  (2) Parameters CFILTER and CGAIN override the radiometric file label.
  (3) Parameter DCGAIN overrides the dark-current file label.

Note: All ground calibration frames logged prior to November 10, 1988 contained
erroneous values for the gain-state.  Some have since been corrected manually.

.page
RADIOMETRIC CORRECTON:

GALSOS radiometrically corrects the input image using a linear model of the
light-transfer function.  The radiometric correction is performed on a pixel-
by-pixel basis using the following steps:
 
 1. If the pixel is identified in the Blemish File as a low-full-well
    pixel, then the pixel is checked to see if its DN value exceeds
    the full-well-saturation DN for that pixel.  If so, it is flagged
    as a blemish internally to be interpolated over.

 2. The radiometric correction is applied:
                e = z(d - dc)
    where z is retrieved from the Radiometric File and dc is retrieved from
    the Dark-Current File.

 3. Pixels which have been flagged internally as blemishes are interpolated
    over.

 4. The output pixel is scaled to radiometric units R (units of reflectance
    or units of radiance). The user determines the output picture scale by 
    specifying the parameter IOF (reflectance) or CONV (radiance).  The default
    is IOF=1.  (See IOF and CONV parameters)  The scaling is as follows:

	A1 = number of 'I over F' units per DN, where 10,000 I/F units
             would be produced by normal incidence of sunlight on a 
             a Lambert disk at the planet's distance from the sun.
        A2 = number of nanowatts per cm**2 per steradian per nanometer
             wavelength per DN.
.page
    If IOF is specified, then

                                   S1       K
                r = 10000 * e * -------- * --- (D/5.2)**2
                                A1(t-to)    Ko
    where

        S1 = filter-dependent conversion factor from ft-Lamberts to
             I/F units for a reference distance of 5.2 AU from the Sun.
        t  = commanded exposure time of the input image (msec).
        to = line-dependent shutter offset.
        K  = system gain constant for the gain-state of the image.
        Ko = system gain constant for the calibration file gain-state.
        D  = target distance from the Sun (in AU).

    The target distance from the sun is extracted from VICAR label item 
    SOLRANGE.

    Because SOLRANGE was unavailable in Phase 1 images, the solar range
    is determined using SPICE (for these images).  Note that this requires
    knowledge of the target body.  If the target body in the label is
    incorrect, it should be input via the TARGET parameter.  If the solar
    range cannot be determined via SPICE, the following constants (in AU)
    are used: Venus=0.723331, Earth=1.0, Gaspra=2.2016, Ida=2.9485,
    Jupiter=5.2. For ground calibration images, SOLRANGE=5.2.  SOLRANGE
    can be specified directly via the SOLRANGE parameter.

.page
    If CONV is specified, then

                           S2       K
                r = e * -------- * ---
                        A2(t-to)    Ko

    where S2 is the filter-dependent conversion factor from ft-Lamberts
    to units of nanowatts/cm**2/steradian/nanometer.

 5. The output DN is converted to the output 16-bit data format.  The
    output DN range is -32768 to +32767.  Although a negative DN value
    has no physical meaning, this may occur if the dark-current frame has
    a higher dark-current level than that of the input image.

The use of the IOF parameter is to control that the range of DNs output by 
GALSOS are within the halfword range and above zero DN.  As a rule of thumb, 
a target of Jupiter should use the default IOF=1 value, satellites should 
use .1 and rings should use .01.  The user should remember to use the IOF 
value from the VICAR label when converting from DN to reflectance.

If the keyword 'UBWC is specified, the input DN values (d) will be corrected
for uneven-bit-weighting due to the Analog-To-Digital Converter (ADC).  There
are inaccuracies in the operation of the ADC that result in DN bins of unequal 
width.  A table to adjust for the uneven bin distribution is used by GALSOS to
define the correct DN value.  If the input dark-current file is in byte 
format (i.e. an individual dark-current frame), then the correction
will be applied to the dark-current as well.  The current correction table was
supplied by Herb Breneman, 2 Mar 89, and is based on 1975 calibration data.

The UBWC parameter should be used at all times but the correction is most 
effective in when no noise is introduced by compression.  In other words, UBWC
is more effective on lossless compressed images and least effective in lossy 
compressed images.  

.page
ENTROPY CALCULATION:

GALSOS also calculates the entropy of the input (raw) image and stores the
results in the VICAR label.  The average entropy for every 50th line is
calculated and stored in the binary header portion of the VICAR label (ref. 5).
The average entropy of the entire image is stored in the visible portion of the
VICAR label.  Both sets of calculations ignore data drop-outs and Reed/Solomon
overflow lines.  Entropy is in units of bits/pixel.

If the entropy has already been calculated by BADLABELS, this information is
copied from the input image and the entropy calculation is suppressed.  Note,
however, that the user can force a recalculation of the entropy by specifying
'PENTROPY.

Keyword 'PENTROPY causes the entropy for every 50th line and the entire image
to be printed.

.page
CREATING THE OUTPUT IMAGE LABEL:

If the input image (PIC) is a UDR or REDR, the output image will be in EDR
format (ref 5).  Otherwise, the output will contain no binary label information.

GALSOS copies all binary label information from the input UDR or REDR to the
output EDR.  Bad-data records are copied or added as described above (see
TRACKING BAD-DATA VALUES).

The following information is added to the EDR header record:
        SCALE(1)        DN-to-reflectance scale factor
        SCALE(2)        DN-to-radiance scale factor
        Slope-File      Radiometric file name
        Offset-File     Dark-current file name

The ASCII text portion of the label is copied from the UDR/REDR and the
following label items added:

        IOF             DN-to-reflectance scale factor
        CNV             DN-to-radiance scale factor
        CAL             Radiometric file name
        DC              Dark-current file name
        BLM             Blemish file name
        SO              Shutter-offset file name

Finally label item NLB is updated to reflect all binary labels added.

.page
LOGGING IN TO SYBASE:

If the SSI catalog is implemented at your installation, GALSOS can perform the
following functions:

  (1) automatically determine the location of all calibration data required to
      radiometrically correct the input image.
  (2) record the corrected image (EDR) in the ssiCorrected table of the catalog.

In order to enable these catalog functions, the parameters CATSRV, CATDB,
CATUSR, and CATPW must be specified so that GALSOS can log in to the catalog,
as in the following example:

  GALSOS  INP=UDR  OUT=EDR  +
       CATSRV=MIPSDB1 CATDB=devCat CATUSR=xxx  CATPW=xxxxxx
where
  CATSRV is the name of the catalog server.
  CATDB is the name of the Sybase catalog.
  CATUSR is the user's Unix ID.
  CATPW is the user's Sybase password.
 
Note that parameters CATSRV, CATDB, CATUSR, and CATPW are case sensitive.

.page
UPDATING THE SSI CATALOG:

If the input image is a UDR or REDR, the output image will be an EDR.  If
the keyword 'UPDATE is specified, the output EDR is recorded in the ssiCorrected
table of the catalog.  The following information about the EDR is placed in the
record:

  SCLKSTRTCNT      Spacecraft clock (RIM + 100*MOD91)
  SCLKPARTITION	   Spacecraft clock partition  
  RAWNUM           Version number of input UDR or REDR
  DCFILENAME       Dark-current file name
  SLOPEFILENAME    Calibration slope file name
  BLMSHFILENAME    Blemish file name
  SOFILENAME       Shutter-offset file
  NEGATIVEDN       Number of negative DN values
  ZERODN           Number of zero DN values
  POSITIVEDN       Number of positive DN values
  MEANREFLCTNC     Mean reflectance
  REFSCALFACT      Conversion factor from DN to reflectance
  MEANRADIANCE     Mean radiance
  RADSCALFACT      Conversion factor from DN to radiance
  FTLTORADIANCE    Foot-Lambert to radiance conversion factor
  FTLTOREFL        Foot-Lambert to IOF conversion factor
  ENTROPY          Mean entropy (bits/pixel)
  UNEVNBTFLAG      Uneven bit-weight correction (1=ON/0=OFF)
  FILEPATH         EDR directory, specified via Unix pathname.
                      includes trailing "/".
  FILENAME         EDR file name, specified as "filename.extension"
  FILESTATUS       1 = on disk  

If a record for the frame already exists in the ssicorrected Table, GALSOS
will replace it with the new record.

In addition, GALSOS sets the GALSOSDONE flag in the ssioverview Table of
the Catalog.

See Reference 8 for more detailed description of the catalog fields updated.

Note: GALSOS is designed to operate whether or not the SSI Catalog is available.
  
 
.page
EXAMPLES:

  1) GALSOS  A  B  DIR=GLL:[LAW]	!VMS execution
     or
     GALSOS  A  B  DIR=/gll/law/	!Unix execution

     The input image A is radiometrically corrected.  Since the radiometric
     scaling is defaulted, the output image B will be in units of reflectance
     (IOF), with an IOF scaling factor of 1.0.  All calibration files are
     assumed to be located in directory GLL:[LAW] and to follow the file
     naming conventions defined by subroutine GLLCALNAME.  No access to
     the SSI catalog is attempted.

  2) GALSOS  A  B  DIR=GLL:[LAW]  DIRDC=GLL2:[LAW]  CAL=CAL.GRN  DC=DC.GRN +
         BLEM=BLEM.DAT  OFFSETS=OFFSETS.DAT

     All calibration files are specified.  They are found in disk directory
     GLL:[LAW], except for the dark-current file which is in GLL2:[LAW].
     Processing is to continue even if the calibration files are considered
     incompatible with the input image ('NOCHECK keyword).  On Unix,
     the directories would be specified as follows:

     GALSOS  A  B  DIR=/gll/law/  DIRDC=/gll2/law/  CAL=CAL.GRN  DC=DC.GRN +
         BLEM=BLEM.DAT  OFFSETS=OFFSETS.DAT

  3) GALSOS  A  OUT=GLL:[LAW320.EDR]S012345678.1  CONV=0.001  'UPDATE  +
         CATUSER=gmy  CATPW=calico  CATSRV=MIPSDB1 CATDB=devCat

     The SSI catalog is accessed.  The location of all calibration files is
     obtained from the ssiRadiometric table.  Upon completion, the output
     EDR is recorded in the ssiCorrected table ('UPDATE).  Note that if
     'UPDATE is specified, a full directory specification must be given for
     the output EDR.  The corresponding execution on Unix is:

     GALSOS  A  OUT=/gll/law/edr/S012345678.1  CONV=0.001  'UPDATE  +
         CATUSER=gmy  CATPW=calico  CATSRV=MIPSDB1 CATDB=devCat
          
.page
PROGRAM HISTORY:

Original  Programmer:  Jean Lorre,   1 May 79
Cognizant Programmer:  Gary Yagi

During the Venus and Earth-1 encounters, images were taken through an optics
cover.  The cover was jettisoned prior to the Gaspra encounter.  Before the
G29 orbit, all exposures were preceded by a light flood.  Beginning with G29,
all exposures were taken without a light flood.

Because of changes to camera sensitivity, different ft-Lamberts to reflectivity
and ft-Lamberts to nanowatts conversion factors (S1 and S2 above) are used for
the following phases of the mission: (1) Venus, (2) Earth-1, (3) Gaspra,
(4) G29 and beyond.

The original conversion tables are from Ken Klaasen's memo, July 2, 1991.
The values for Gaspra are from Klaasen's memo, Nov 18, 1997.
The values for G29 are from Klaasen's memo, Feb 11, 2002.

The current system gain constants are from a memo by Klaasen dated April 1992.

Revisions:
  22 Feb 02   GMY  Add reflectance and radiance coversion tables for G29.
  19 MAY 99   HBM           Update help for UBWC and IOF
  26 Oct 98   GMY           Extract solar range from label or SPICE.
  13 AUG 98...R.R.PATEL.....REMOVED TRANS_BLEM SINCE IT WAS CAUSING PROBLEM
                            ON VMS. IT IS NOW REPLACED WITH ZVREAD (REFER TO
                            AR-100482).
  30 MAR 98...R.R.PATEL.....UPDATED TO WORK WITH SUMMATION MODE FLIGHT-IMAGES
                            WITH NO BINARY HEADER.
   7 Dec 97   G. Yagi       Update radiance scale to Nov 18 memo
  30 APR 97...R.R.PATEL.....REMOVED THE CHECK FOR HISTORY LABEL ENTROPY AND
                            ADDED CHECK TO SEE IF BADLABELS HAS BEEN RUN ON
                            INPUT.
   7 Feb 97   G. Yagi	    Correct call to zlget to retrieve ENTROPY from
                            label (FR 89917)
  14 Aug 96   G. Yagi	    Add SSI readout mode to call to GLLCALNAME
                            (FR 89118)
   1 Jul 96   G. Yagi       Update Gaspra reflectance/radiance scale factors
  21 Jun 95   G. Yagi       Fix badlabels (FR 85892)
                            Modify so it compiles when Sybase is not available.
  10 May 95   G. Yagi       Update reflectivity and radiance constants as per
                            Klaasen memo dated May 8 1995 (FR 85151).
  10 Apr 95   G. Yagi       Check for invalid SEGMENTS field in Ph2 UDRs
                                (FR 85642).
  27 Mar 95   G. Yagi       Fix bug getting PICSCALE for halfword DC (FR 85641).
  10 Mar 95   G. Yagi       More Phase2 changes
  18 Nov 94   T. Truong	    Added PhaseII and Sybase interface
                            Removed support for XED telemetry format
   5 May 94   G. Yagi       Recognize Ida as a target (FR 85136).
  15 Dec 93   G. Yagi       Skip blemish removal if line is missing (FR 81894).
  13 Dec 93   G. Yagi       Changed to accept 800x800 summation-mode dark
                            current files (FR 81876).
                            Changed to extract last instance of PICSCALE in the
                            VICAR label (FR 81877).
                            Increase blemish file size to 10,000.
  03 Aug 93   G. Yagi       Added Ida and Moon as valid targets (FR 81828)
  13 Jul 93   G. Yagi       Fixed low-full-well bug (FR 81855)
                            Store FTLTORAD and FTLTOIOF in catalog (FR 81826)
                            Get SCLK from ABLE86 (FR 81747)
  04 Sep 92...W. Lee........Resolved Catalog probelm (FR #75744)
  02 Sep 92...W. Lee........Fixed Entropy calculation for Reed-Solomon UDR
                            (FR #76878)
  08 Jul 92...W. Lee........Fixed "White Spot" troubles associated with 
                            GLLBLEMCORed REDR (FR #75754 -- GLLBLEMCOR)
  02 Jul 92...W. Lee........Removed Gain-Constant-Ratio dependency in Radio-
                            metric correction (FR #76877)
  30 Jun 92...W. Lee........Removed Reed-Solomon Overflows from Entropy Cal-
                            culations (FR #76878)
  25 Jun 92...W. Lee........Disabled the usage of Reed-Solomon Overflow for
                            LFW corrections (FR #75724)
  15 Jun 92...W. Lee........Restructured Input Logical Mechanism for Cali-
                            bration Files (FR #75726)
  10 Jun 92...W. Lee........Added informative messages about the loading of
                            the SSI_CORRECTED catalogue (FR #75744) 
  01 Jun 92...G. Yagi.......Major upgrade to help file.  
  25 Feb 92...W. Lee........Miscellaneous Upgrades:  (NO FRs !)
                            Updated HELPs, Included EXT for calibration 
                            files in Label, Rejected Input if it is a BLEM-
                            ished UDR etc.  
  25 Feb 92...W. Lee........Implemented the "Consolidated Slope" approach
                            ONLY for the RADIOMETRIC mode (FR #68966)
  18 Feb 92...W. Lee........Removed large discrepancies among EDRs generated 
                            via different "routes" (FR #73797)
  12 Feb 92...W. Lee........Updated Gain Ratios to the 1991 values
                            (FR #66567)
  07 Feb 92...W. Lee........Resolved problem associated with the "GLLBLEMCOR" 
                            message (FR #73795)  
  05 Feb 92...W. Lee........Resolved DIR & DISK issue for CALIBRATION file in
                            association with the RADIOMETRIC mode (FR #73800)
  24 Jan 92...W. Lee........Fixed DEV crash problem  (FR #73782)
  27 Dec 91...W. Lee........Changed "BLM" Label insertion so that output EDR can
                            be processed by BADSHOW (FR #73714)
  16 Dec 91...W. Lee........Modified to correctly verify BADLABEL & GLLBLEMCOR
                            processings for an input CDROM REDR (FR #70966)
  14 Nov 91...W. Lee........Closed FR #70937 with NO software corrections 
  07 Nov 91...W. Lee........Incorporated PCA Capability
  28 Oct 91...W. Lee........ON-OFF changed to UBWC-NOUBWC (#70927)
  28 Oct 91...W. Lee........All References to VIO changed to VLT (FR #70926)
  07 Oct 91...W. Lee........Added a preceding statement about the 'DISALLOW 
                            keyword (FR #70928)
  30 Aug 91...W. Lee........Conversion Factors depend on Mission PHASE
                            (FR #70924)
  30 Aug 91...W. Lee........Fixed Empty Blank problem for OFFSET in binary
                            header (FR # 70925)
  14 Aug 91...W. Lee........Fixed Ground Summation problem (FR #70904)
  09 Aug 91...W. Lee........Updated Conversion Factors based on latest memo
                            by K. Klaasen (FR #70902)
  30 Jul 91...W. Lee........Implemented modifications to process REDR image
                            (SCR #B071)
  24 Jun 91...W. Lee........Put Dark-Current file in the OFFSET location in
                            Binary Header (FR #66503)
  10 Jun 91...W. Lee........Added Radiometric Table Interface for Calibration
                            Files extraction
  05 Jun 91...W. Lee........Changed "ON/OFF" to "UBWC/NOUBWC" for Bit-Weighting
                            (LKW320 Mail, dated June-04-91) 
  17 May 91...W. Lee........Added "RS_OVERFLOW" BDV in Binary Header
                            (IOM 384-91-3 by GMY, dated May-14-91, FR #63282)
  07 May 91...W. Lee........Set Edr_Status = 1 (= On DISK) in Corrected Table
                            (FR #68831) 
  30 Apr 91...W. Lee........Implemented Independent Directories for Calibra-
                            tion Files (FR #68858)
  25 Apr 91...W. Lee........Updated Filter Paramters for Venus and Earth-1
                            Mission (FR #64651) 
  09 Apr 91...W. Lee........Added "GALSOS_DONE" in Overview Table (FR #64653)
  02 Apr 91...W. Lee........Added GASPRA to TARGET (FRs #64650 & 66673)
                            If TARGET is NOT specified by User, pull the Target
                            name from VICAR label
  01 Apr 91...W. Lee........Disabled Frame-Rate inconsistency check between
                            input Image and Blemish file (FR #64617)
  31 Mar 91...W. Lee........Moved ground calibration parameters to the bottom
                            of the PDF parameter list (FR #66589)
  30 Nov 90...A.Runkle......Changed VICAR label keyword ENTRPY to ENTROPY
  11 Nov 90...A.Runkle......Changed parameters so GALSOS can run in a
                            proceedure properly
                            Added assignment of RAW_VERSION in catalog update
                            Added Blemish file checks for filter, gain & rate
                            Corrects summation mode usage of shutter offset
                            file
  30 Oct 90...G.Yagi........Adjusted filter factors for optics cover
  04 Oct 90...A.Runkle......Changed NOCAT parameter to CATALOG and added a
                            a new default & new values
                            Changed IOF and CONV parameters to SCALETYP and
                            SCALEVAL for easier use in procs.
  23 Aug 90...A.Runkle......Test script update
                            Replace SOLRANGE when TARGET specified
  15 Jul 90...A.Runkle......Changed locdation of closing files
                            Added another status check in catalog code
  01 Jun 90...A.Runkle......Added PENTROPY keyword & printing code
  25 Apr 90...A.Runkle......Added NOCAT keyword & catalog entry code
                            Added BADFILES keyword & bypass code
                            Changed QPRINTS to XVMESSAGE
                            Corrected GLLCALNAME call for shutter offset file
  29 Mar 90...A.Runkle......Added TARGET keyword
                            Corrected variable declaration and usage
                            Fixed GLLCALNAME parameter list
  14 Feb 90...A.Runkle......Corrected algorithm for calculating A1 & A2 values
                            Added entropy calculations
  26 Oct 89...A.Runkle......Corrected test script
                            New ABLE86 parameter structure
  14 Jul 89...A.Runkle......Support Bad Data Value records
  28 Mar 89...A.Runkle......Support flight data (binary headers)
  12 Mar 89...G.Yagi........Delete halfword input capability.
  08 Mar 89...G.Yagi........Add uneven-bit-weight correction option.
  01 Nov 88...G.Yagi........Fix S1 and S2 conversion tables.
  26 OCT 88...G.Yagi........Fix check for summation mode offsets.
  20 OCT 88...G.Yagi........Fixed EXPOSURE parameter.
  28 MAY 88...G.Yagi........Minor changes to help file (FR #36087).
                            Add processing of double-column blemishes
                            Add CGAIN, DCGAIN parameters
  01 APR 88...G.Yagi........Scale output DN to radiometric units
  10 Dec 87...G.Yagi........New radiometric and offset file formats
  18 May 87...G.Yagi........Do scaling in DECAL subroutine
  20 Mar 86...G.M.YAGI......Assembler MDECAL1 & MDECAL2
  15 MAY 85...D.F.STANFILL..NEW VERSION WITH BLEMGEN IN VAX C
  24 OCT 84...G.M.YAGI......CONVERSION TO VAX VICAR*2
  20 APR 84...M.E.MORRILL...REWRITTEN IN VAX FORTRAN VICAR1*

.LEVEL1
.VARIABLE INP
STRING--REQUIRED
INP=raw image
.VARIABLE OUT
STRING--REQUIRED
Output radiometrically
corrected image.
.VARIABLE DIR
STRING--OPTIONAL
Default directory for
calibration files.
.VARIABLE DIRCAL
STRING--Optional
Directory containing
Radiometric File
.VARIABLE DIRDC
STRING--Optional
Directory containing
Dark Current File
.VARIABLE DIRBLM
STRING--Optional
Directory containing
Blemish File
.VARIABLE DIROFF
STRING--Optional
Directory containing
Shutter OFFset File
.VARIABLE CAL
STRING--Optional
Input Radiometric File.
.VARIABLE DC
STRING--optional
Input Dark-Current File.
.VARIABLE BLEM
STRING--optional
Input Blemish File.
.VARIABLE OFFSETS
STRING--optional
Input Shutter-Offset File.
.VARIABLE SCALETYP
KEYWORD--OPTIONAL
IOF or CONV
.VARIABLE SCALEVAL
Real--optional
IOF per DN or
Radiance per DN 
.VARIABLE BITWT
KEYWORD--OPTIONAL
Uneven-bit-weighting
correction
('UBWC /'NOUBWC)
.VARIABLE SOLRANGE
KEYWORD--OPTIONAL
Solar range (km)
.VARIABLE UPDATE
KEYWORD--OPTIONAL
Update SSI catalog
.VARIABLE NOCHECK
KEYWORD--OPTIONAL
Suppresses checking for
parameter mismatches.
.VARIABLE PENTROPY
KEYWORD--OPTIONAL
Print entropy values
.VARIABLE FILTER
INTEGER--OPTIONAL
Filter position for
input image (0-7)
.VARIABLE GAIN
INTEGER--OPTIONAL
Gain state for
input image (1-4)
.VARIABLE EXPOSURE
INTEGER--OPTIONAL
Exposure time for
input image (msec).
.VARIABLE CFILTER
INTEGER--OPTIONAL
Filter position for
Radiometric file (0-7)
.VARIABLE CGAIN
INTEGER--OPTIONAL
GAIN state for
Radiometric file (1-4).
.VARIABLE DCGAIN
INTEGER--OPTIONAL
Gain state for
Dark-Current File (1-4)
.var UPDATE
Optional keyword - update catalog
.var CATUSR
Optional string - catalog user
.var CATPW
Optional string - catalog password
.var CATSRV
Optional string - catalog server
.var CATDB
Optional string - catalog database
.VARI TARGET
Optional 12-char string
Target name (planet,
  satellite, or asteroid)
.VARI SPICEMODE
Optional keyword
Location of SPICE kernels
(LOCAL or REMOTE)
.VARI CKNAME
Optional 4-char string
C-kernel name
.VARI CKID
Optional 4-char string
C-kernel ID
.var DEBUG
Optional keyword
Print diagnostic messages
.LEVEL2
.VARIABLE INP
   INP=IN
 where IN is an image to be radiometrically corrected (byte or halfword).
.VARIABLE OUT
 OUT is the radiometrically corrected output image (16-bit data).
.VARIABLE DIR
 DIR specifies the default disk and directory location of all calibration files.
 DIR may be specified as a VMS DISK:[DIR] or Unix pathname.
	DIR=WMS_GLL:[SSI.RAD]
     or DIR=/project/gll/ssi/rad/
 DIR may be overridden for specific files via parameters DIRCAL, DIRDC, DIRBLM,
 and DIROFF (see below).
.VARIABLE DIRCAL
	DIRCAL=WMS_GLL:[SSI.RAD]	(VMS)
     or DIRCAL=/project/gll/ssi/rad/	(Unix)
 DIRCAL specifies the directory location of the radiometric (slope) file.
 When specified, DIRCAL overrides the default directory (see DIR parameter) for
 the radiometric file only.
.VARIABLE DIRDC
	DIRDC=WMS_GLL:[SSI.RAD]	(VMS)
     or DIRDC=/project/gll/ssi/rad/	(Unix)
 DIRDC specifies the directory location of the dark-current file.
 When specified, DIRDC overrides the default directory (see DIR parameter) for
 the dark-current file only.
.VARIABLE DIRBLM
	DIRBLM=WMS_GLL:[SSI.RAD]	(VMS)
     or DIRBLM=/project/gll/ssi/rad/	(Unix)
 DIRBLM specifies the directory location of the blemish file.
 When specified, DIRBLM overrides the default directory (see DIR parameter) for
 the blemish file only.
.VARIABLE DIROFF
	DIROFF=WMS_GLL:[SSI.RAD]	(VMS)
     or DIROFF=/project/gll/ssi/rad/	(Unix)
 DIROFF specifies the directory location of the shutter-offset file.
 When specified, DIROFF overrides the default directory (see DIR parameter) for
 the shutter-offset file only.
.VARIABLE CAL
 STRING
 Input Radiometric File, as generated by program GALGEN.  The Radiometric
 File's filter position must match the filter position of the input image.
 The filename should NOT include the directory of the file; refer to the 
 DIR and DIRCAL parameters for specifying the directory.
.VARIABLE DC
 STRING
 Input dark current file, in byte or halfword format.  Dark current files
 may be (1) zero exposure frames, (2) a sum of zero exposure frames (see
 PICSUM), or (3) as computed by program GALGEN.

 The dark current file must match the input image in gain state and frame rate.
 Also, extended-exposure mode frames require extended-exposure dark currents.
 The filename should NOT include the directory of the file; refer to the DIR
 and DIRDC parameters for specifying the directory.

.VARIABLE BLEM
 STRING
 Input Blemish File, as generated by program BLEMGEN.  The filename should NOT
 include the directory of the file; refer to the DIR and DIRBLM parameters for 
 specifying the directory.
.VARIABLE OFFSETS
 STRING
 Input Shutter-Offset File, as generated by program CCDRECIP.  The
 Shutter-Offset File is independent of all camera modes, and a single file
 may be used (for a fixed temperature).  The filename should NOT include the
 directory of the file; refer to the DIR and DIROFF parameters for specifying
 the directory.
.VARIABLE IOF
	IOF=r
where r specifies the output DN scale in number of 'I over F' units per DN.
10,000 'I over F' units would be produced by normal incidence of sunlight
on a Lambert disk at Jupiter's distance from the sun (5.2 A.U.).
The default is IOF=1.0.
.VARI CONV
	CONV=r
where r specifies the output DN scale in number of nanowatts per cm**2 per
steradian per nanometer wavelength per DN.
If not specified, the output is in units of IOF.
.VARIABLE BITWT
Keyword 'UBWC specifies uneven-bit-weight correction (default is 'NOUBWC).
.VARIABLE ENTROPY
Keyword 'NOCALC suppresses calculation of image entropy (default is 'CALC).
If 'NOCALC is specified, then the catalog entries for entropy will be set to
zero.
.VARI SOLRANGE
	SOLRANGE=r
where r specifies the solar range (distance for target to sun) in km.

If not specified the following actions are taken:
  (1) If the input image is in Phase1 format, the following constants are
      used: Venus=0.723331 AU, Earth=1.0 AU, Gaspra=2.2016 AU, Ida=2.9485 AU,
      Jupiter=5.2 AU.
  (2) For Phase 2, SOLRANGE is extracted from the VICAR label.
  (3) For ground calibration images, SOLRANGE=5.2 AU.
.VARIABLE UPDATE
Keyword 'UPDATE causes the output EDR to be recorded in the ssiCorrected table
of the SSI Catalog.  If the output image is not an EDR, this keyword has no
effect.  Note that if 'UPDATE is specified, the complete directory specification
must be given for OUT:
     OUT=GLL:[LAW320.EDR]S01234567.2
  or OUT=/gll/law/edr/s01234567.2
.VARIABLE NOCHECK
Keyword 'NOCHECK specifies that processing should continue even though the
specified calibration files do not match the input files parameters: gain,
frame-rate, filter & FIBE (where applicable).  Warning messages identifying
the suspected files are displayed along with a continuation with error
message.  The default is to terminate processing if mismatches are detected.
.VARIABLE PENTROPY
Keyword 'PRINT causes printing of the results of the entropy calculations for
the entire image and for every 50th line (default is 'NOPRINT).  Note that
this keyword can be used to force the entropy to be calculated, even if it
has been previously calculated by BADLABELS.
.VARIABLE FILTER
INTEGER--OPTIONAL (ground calibration data only)
Filter position (0-7)
	FILTER=0  for Clear
	      =1  for Green
	      =2  for Red
	      =3  for Violet
	      =4  for 7560
	      =5  for 9680
	      =6  for 7270
	      =7  for 8890
.VARIABLE GAIN
INTEGER--OPTIONAL (ground calibration data only)
Specifies camera gain state for input image.
	GAIN=1  for 400K (lowest gain state)
	    =2  for 100K
	    =3  for 40K
	    =4  for 10K  (highest gain state)
The default gain-state is 4 for 800x800 images, and 1 for 400x400
(summation-mode) images.
.VARIABLE EXPOSURE
INTEGER--OPTIONAL (ground calibration data only)
Specifies the exposure time of the input image (msec).
.VARIABLE CFILTER
INTEGER--OPTIONAL (ground calibration data only)
Filter position for
calibration file (0-7)
.VARIABLE CGAIN
INTEGER--OPTIONAL (ground calibration data only)
Specifies camera gain state for calibration file.
       CGAIN=1  for 400K (lowest gain state)
	    =2  for 100K
	    =3  for 40K
	    =4  for 10K  (highest gain state)
The default gain-state is 2 for 800x800 images, and 1 for 400x400
(summation-mode) images.
.VARIABLE DCGAIN
INTEGER--OPTIONAL (ground calibration data only)
Specifies gain state for the Dark-Current File.
      DCGAIN=1  for 400K (lowest gain state)
	    =2  for 100K
	    =3  for 40K
	    =4  for 10K  (highest gain state)
The default gain-state is 2 for 800x800 images, and 1 for 400x400
(summation-mode) images.
.var CATUSR
User's Unix ID:
  CATUSER=aaa     (optional, case sensitive)
.var CATPW
User's Sybase password:
  CATPW=aaaxxx    (optional, case sensitive)
.var CATSRV
Name of catalog server:
  CATSRV=xxxxxx  (optional, case sensitive)
Default is CATSRV=MIPSDB1.
.var CATDB
Name of catalog database:
  CATDB=xxxxxx    (optional, case sensitive)
Default is CATDB=devCat

.VARI TARGET
Ex: TARGET=GANYMEDE specifies that GANYMEDE is the target in the input image.

The TARGET may be a planet, satellite, or asteroid.  If defaulted, the target
name is extracted from the VICAR label or determined by other TBD means.

A complete list of valid target names is located in the ASCII file assigned
the logical name (or environmental variable) BODY_IDS.

.VARI SPICEMODE
SPICEMODE=LOCAL specifies that SPICE data is to be retrieved from local
SPICE kernels.  SPICEMODE=REMOTE specifies that SPICE data is to be retrieved
via the SPICE server.  If SPICEMODE is defaulted, the logical name (or
environmental variable) DEFAULTSPICE is used to determine whether LOCAL or
REMOTE is used.  Note that if SPICE data is not found in LOCAL or REMOTE mode,
the other mode is attempted.

.VARI CKNAME
CKNAME is a four character string specifying the C-kernel to be used:

  CKNAME	C KERNEL
  --------      -------------
  DAVI		MIPS_DAVI.CK
  NAV		MIPS_NAV.CK
  FARE		MIPS_FARENC.CK
  NAV2		MIPS_NAV2.CK
  NEAR		MIPS_NEAR.CK
  AMOS		MIPS_AMOS.CK
  NAIF		the best NAIF kernel is used

If defaulted, the kernels are searched in the above order.

.VARI CKID
CKID is an alternative way to specify the prefered C-kernel (see CKNAME
parameter):

  CKID	  CKNAME	C KERNEL
  ----	  --------      -------------
  M906	  DAVI		MIPS_DAVI.CK
  M905	  NAV		MIPS_NAV.CK
  M904	  FARE		MIPS_FARENC.CK
  M903	  NAV2		MIPS_NAV2.CK
  M902	  NEAR		MIPS_NEAR.CK
  M901	  AMOS		MIPS_AMOS.CK
  varies  NAIF		there are a large number of these files

Ex:  CKID=M901 specifies the four character ID which uniquely identifies the
     C-kernel MIPS_AMOS.CK.

A complete list of the C-kernel IDs is located in the ASCII file assigned the
logical name (or environmental variable) KERNELDB.

If specified, CKID overrides the CKNAME parameter.

.var DEBUG
'DEBUG causes diagnostic messages to be printed (for debugging the program).
.End
