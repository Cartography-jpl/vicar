PROCESS HELP=*
  local a type=string
  local (b,c,d) type = integer
  PARM INPUT   TYPE=STRING COUNT=1
  PARM ONAM    TYPE=NAME  default = a
  PARM ISTAPE  TYPE=NAME  default = b
  PARM TAPEPOS TYPE=NAME  default = c
  PARM NXTFIL  TYPE=NAME  default = d

!# annot function="VICAR Procedure Generation"
!# annot keywords=(SRCH,ONAM,ISTAPE,TAPEPOS,NXTFIL,"LIST.DAT",+
!#  "Output parameter","TAE variable",NXT,CNT,SRCH)
END-PROC
.TITLE
Returns data for next file in a SRCH list
.HELP
NXT takes a list file which was written by the program SRCH and 
returns information about the next file in the list.  The values 
are returned in ONAM, ISTAPE, TAPEPOS, and NXTFIL.  Upon completion, ONAM
contains the name of the disk file or tape which is next in the list.

If the file is a tape, ISTAPE will be 1, otherwise it will be 0.

If ISTAPE is 1, then TAPEPOS will contain the file position number on 
the tape.

NXTFIL contains the (ordinal) number of the returned file within the list file.

NXT needs to have write access to the input file and to its directory because
it modifies the first record of the file.  The recommended method for accessing
a SRCH file owned by another user is to make a copy of it in one's account.
.page
Example:

The following procedure could be used to get a list of the 
system label of each file in the list file LIST.DAT.

PROCEDURE
  LOCAL FILENAM TYPE=STRING
  LOCAL ISTAPE TYPE=INT
  LOCAL POSITION TYPE=INT
  LOCAL FILENUM TYPE=INT
BODY
  RESET LIST.DAT
  write ('resetting')
  LOOP
    NXT LIST.DAT FILENAM ISTAPE POSITION FILENUM
    IF (FILENAM = "END_OF_FILE") BREAK
    IF (ISTAPE)
        ALLOC MT T
	MOUNT T COMMENT="Please mount tape &FILENAM"
	LABEL-LIST &FILENAM/&POSITION 'SYS
      ELSE
        LABEL-LIST &FILENAM 'SYS
    END-IF
  END-LOOP
END-PROC

.page
HISTORY:
   REVISIONS :

    9-86   SP   changed fscanf to sscanf and changed                  
                format specifier from "%5d" to "10%d"                 
                to allow users to modify the first record in file.    
                added code to check for first record having a         
                different length than expected and to handle this.    
    9-86   SP   modified to output to a TAE variable the number of the
                file (as done in program CNT) per Charlie Avis.       
                note that this change the calling sequence of NXT by  
                adding another required parameter, NXTFIL.            
    2-87   SP   Added code to handle  NO RECORDS in SRCH file.        
    6-94   SVH  Ported to UNIX - Steve Hwan				
    6-96   OAM  Included a REWIND statement and a loop in the VMS part
		to avoid dropping filenames as it updates the NEXT FILE
                number.  FR 89371.
    8-97   RRD  Added first fseek call after #else (the UNIX specific 
		section) because a previous call to fscanf had moved 
		the current position in the file and this fixes it.

.LEVEL1
.VARI INPUT 
List file
.VARI ONAM
Output -- the next name
in the list
.VARI ISTAPE
Output -- TRUE (1) if tape
.VARI TAPEPOS
Output -- File position number
.vari nxtfil
Output -- Number of next
file in list.
.LEVEL2
.VARI INPUT
The input file which was generated by the program SRCH.  The file
contains a list of file names from which the next entry is to be
selected.
.VARI ONAM
After exiting NXT, the parameter name given for ONAM contains
the next filename in the list contained in INPUT.  If the file
is on a tape, then ONAM contains the name of the tape.

See the example under HELP NXT.
.VARI ISTAPE
ISTAPE is an output integer from NXT which is 1 (logical TRUE) if
the file given in ONAM is a tape, and 0 (logical FALSE) if it is not.

ISTAPE may be used like a logical expression in TCL, like

  IF (ISTAPE) ...

See the example under HELP NXT.
.VARI TAPEPOS
TAPEPOS indicates the file number on the tape when the output from
ONAM is a tape file (ISTAPE is 1).

See the example under HELP NXT.
.vari nxtfil
Upon completion of NXT, the parameter given for NXTFIL contains the
number of the next file to be referenced in the INPUT list (corresponding
to ONAM).
.END
